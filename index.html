<html>
	<head>
		<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
		<script src="https://unpkg.com/moralis/dist/moralis.js"></script>
		<script src="config.js"></script>
	</head>
	<body>
		<button onclick="main()">LamboAuth</button>
		<script>

			Moralis.initialize(applicationID);
			Moralis.serverURL = serverURL;

			var userAddress = "";
			var nfts = [];

			login = async () => {
				const user = await Moralis.Web3.authenticate({
					signingMessage: "LamboAuth"
				});
				userAddress = await user.get("ethAddress");
				console.log(userAddress);
			}

			getNFTsOfContract = async () => {
				var options = {
					chain: "eth",
					offset: 0,
					order: "token_id.ASC",
					address: "0xda9f43015749056182352e9dc6d3ee0b6293d80a"
				};
				var currentNFTs = [];
				for (; options["offset"] < 2000; options["offset"] += 500) {
					currentNFTs = await Moralis.Web3API.token.getNFTOwners(options);
					currentNFTs = currentNFTs["result"];
					nfts = await nfts.concat(currentNFTs);
				}
				console.log(nfts);
			}

			lamboAuth = async () => {
				if (await nfts.some(e => e["owner_of"] === userAddress)) {
					window.location.href = "https://lamboauth.eldc.co/success.html";
					return;
				}
				window.location.href = "https://lamboauth.eldc.co/failure.html"
			}

			main = async () => {
				await login();
				await getNFTsOfContract();
				await lamboAuth();
			}

		</script>
	</body>
</html>